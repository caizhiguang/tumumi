<?xml version="1.0" encoding="utf-8" ?> 
<!--============================================================================
//	CAUTION: This file is generated by IBatisNetGen.BatisMap.cst at 2011-1-10 9:28:25
//				By xincai.wu
//===========================================================================-->
<sqlMap namespace="TJoinDoc"
	xmlns="http://ibatis.apache.org/mapping" 
	xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">

	<alias>
		<typeAlias alias="TJoinDoc" type="TMM.Model.TJoinDoc,TMM.Models" />		
	</alias>

	<statements>

		<select id="GetCount"  parameterClass="map" resultClass="System.Int32">
			SELECT count(*) FROM [T_JoinDoc]
			<dynamic prepend="WHERE">
				<isPropertyAvailable property="TId" prepend="AND">
					[TId] = #TId#
				</isPropertyAvailable>
				<isPropertyAvailable property="UserId" prepend="AND">
					[UserId] = #UserId#
				</isPropertyAvailable>
				<isPropertyAvailable property="Title" prepend="AND">
					[Title] = #Title#
				</isPropertyAvailable>
				<isPropertyAvailable property="DocId" prepend="AND">
					[DocId] = #DocId#
				</isPropertyAvailable>
				<isPropertyAvailable property="LikeTitle" prepend="AND">
					<![CDATA[				  
				  [Title] like '%$LikeTitle$%'
				  ]]>
				</isPropertyAvailable>
        <isPropertyAvailable property="IsWin" prepend="AND">
          [IsWin] = #IsWin#
        </isPropertyAvailable>
			</dynamic>
		</select>
		

		<select id="GetList" parameterClass="map" resultClass="TJoinDoc">
      SELECT
      [JoinId]
      , [TId]
      , [UserId]
      , [Title]
      , [DocId]
      , [IsWin]
      , [Price] as [ReqDoc.Price]
      , [EndTime] as [ReqDoc.EndTime]
      , [ReqDoc.CreateTime] as [ReqDoc.CreateTime]
      , [ReqUserId] as [ReqDoc.UserId]
      , [WinTime]
	  , [CreateTime]
      FROM
      (SELECT
      <isPropertyAvailable property="Top" prepend="">
				Top (#Top#)
			</isPropertyAvailable>
			<isPropertyAvailable property="OrderBy" prepend="">
				ROW_NUMBER() OVER (order by $OrderBy$) as RowNumber,
			</isPropertyAvailable>
      a.*,b.Price,b.EndTime,b.CreateTime as [ReqDoc.CreateTime],b.UserId as [ReqUserId]
      FROM [T_JoinDoc] a INNER JOIN [T_ReqDoc] b
      ON a.TId=b.TId
      <dynamic prepend="WHERE">
				<isPropertyAvailable property="TId" prepend="AND">
					a.[TId] = #TId#
				</isPropertyAvailable>
				<isPropertyAvailable property="UserId" prepend="AND">
					a.[UserId] = #UserId#
				</isPropertyAvailable>
				<isPropertyAvailable property="Title" prepend="AND">
					[Title] = #Title#
				</isPropertyAvailable>
				<isPropertyAvailable property="DocId" prepend="AND">
					[DocId] = #DocId#
				</isPropertyAvailable>
			  <isPropertyAvailable property="LikeTitle" prepend="AND">
				  <![CDATA[				  
				  a.[Title] like '%$LikeTitle$%'
				  ]]>
			  </isPropertyAvailable>
        <isPropertyAvailable property="IsWin" prepend="AND">
          [IsWin] = #IsWin#
        </isPropertyAvailable>
			</dynamic>
			) t
			<dynamic prepend="WHERE">
				<isPropertyAvailable property="StartRecord" prepend="AND">
				RowNumber>#StartRecord#
				</isPropertyAvailable>
			</dynamic>
		</select>

    <select id="GetListForXg" parameterClass="map" resultClass="TJoinDoc">
      SELECT
      [JoinId]
      , [TId]
      , [UserId]
      , [Title]
      , [DocId]
      , [IsWin]
      , [DocType] as [DocInfo.DocType]
      , [FileLength] as [DocInfo.FileLength]
      , [DocInfo.CreateTime]
      FROM
      (SELECT
      <isPropertyAvailable property="Top" prepend="">
        Top (#Top#)
      </isPropertyAvailable>
      <isPropertyAvailable property="OrderBy" prepend="">
        ROW_NUMBER() OVER (order by $OrderBy$) as RowNumber,
      </isPropertyAvailable>
      a.*,b.DocType,b.FileLength,b.CreateTime as [DocInfo.CreateTime]
      FROM [T_JoinDoc] a INNER JOIN [D_DocInfo] b
      ON a.DocId=b.DocId
      <dynamic prepend="WHERE">
        <isPropertyAvailable property="TId" prepend="AND">
          a.[TId] = #TId#
        </isPropertyAvailable>
        <isPropertyAvailable property="UserId" prepend="AND">
          a.[UserId] = #UserId#
        </isPropertyAvailable>
        <isPropertyAvailable property="Title" prepend="AND">
          [Title] = #Title#
        </isPropertyAvailable>
        <isPropertyAvailable property="DocId" prepend="AND">
          [DocId] = #DocId#
        </isPropertyAvailable>
      </dynamic>
      ) t
      <dynamic prepend="WHERE">
        <isPropertyAvailable property="StartRecord" prepend="AND">
          RowNumber>#StartRecord#
        </isPropertyAvailable>
      </dynamic>
    </select>
		
		<select id="Get" parameterClass="Int32" resultClass="TJoinDoc">
      SELECT
      [JoinId]
      , [TId]
      , [UserId]
      , [Title]
      , [DocId]
      , [IsWin]
      FROM [T_JoinDoc]
      WHERE
      ([JoinId] = #JoinId#)
    </select>
		
		

		
		<insert id="Insert" parameterClass="TJoinDoc" resultClass="Int32">
      INSERT INTO [T_JoinDoc] (
      [TId]
      , [UserId]
      , [Title]
      , [DocId]
      , [IsWin]
      ) VALUES (
      #TId#
      , #UserId#
      , #Title#
      , #DocId#
      , #IsWin#
      )

      SELECT @@IDENTITY
    </insert>

		<update id="Update" parameterClass="TJoinDoc" resultClass="Int32">
      UPDATE [T_JoinDoc] SET
      [TId] = #TId#
      , [UserId] = #UserId#
      , [Title] = #Title#
      , [DocId] = #DocId#
      , [IsWin] = #IsWin#
      , [WinTime] = #WinTime#
      WHERE
      ([JoinId] = #JoinId#)

      SELECT @@rowcount
    </update>

		<delete id="Delete" parameterClass="int32" resultClass="Int32">
			DELETE FROM [T_JoinDoc]
			WHERE
				([JoinId] = #JoinId#)
				
			select @@rowcount
		</delete>
		
	</statements>
</sqlMap>
