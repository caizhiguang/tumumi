<?xml version="1.0" encoding="utf-8" ?> 
<!--============================================================================
//	CAUTION: This file is generated by IBatisNetGen.BatisMap.cst at 2010-12-17 22:06:21
//				By xincai.wu
//===========================================================================-->
<sqlMap namespace="TOrder"
	xmlns="http://ibatis.apache.org/mapping" 
	xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">

	<alias>
		<typeAlias alias="TOrder" type="TMM.Model.TOrder,TMM.Models" />		
	</alias>

	<statements>

		<select id="GetCount"  parameterClass="map" resultClass="System.Int32">
			SELECT count(*) FROM [TOrder]
			<dynamic prepend="WHERE">
				<isPropertyAvailable property="OrderType" prepend="AND">
					[OrderType] = #OrderType#
				</isPropertyAvailable>
				<isPropertyAvailable property="UserId" prepend="AND">
					[UserId] = #UserId#
				</isPropertyAvailable>
				<isPropertyAvailable property="Email" prepend="AND">
					[Email] = #Email#
				</isPropertyAvailable>
				<isPropertyAvailable property="Total" prepend="AND">
					[Total] = #Total#
				</isPropertyAvailable>
				<isPropertyAvailable property="PayWay" prepend="AND">
					[PayWay] = #PayWay#
				</isPropertyAvailable>
				<isPropertyAvailable property="Ip" prepend="AND">
					[Ip] = #Ip#
				</isPropertyAvailable>
				<isPropertyAvailable property="Status" prepend="AND">
					[Status] = #Status#
				</isPropertyAvailable>
				<isPropertyAvailable property="CreateTime" prepend="AND">
					[CreateTime] = #CreateTime#
				</isPropertyAvailable>
				<isPropertyAvailable property="PayTime" prepend="AND">
					[PayTime] = #PayTime#
				</isPropertyAvailable>
				<isPropertyAvailable property="Remark" prepend="AND">
					[Remark] = #Remark#
				</isPropertyAvailable>
				<isPropertyAvailable property="AdminRemark" prepend="AND">
					[AdminRemark] = #AdminRemark#
				</isPropertyAvailable>
				<isPropertyAvailable property="UpdateTime" prepend="AND">
					[UpdateTime] = #UpdateTime#
				</isPropertyAvailable>
				<isPropertyAvailable property="Sd" prepend="AND">
					<![CDATA[
					[CreateTime] >= #Sd#
					]]>
				</isPropertyAvailable>
				<isPropertyAvailable property="Ed" prepend="AND">
					<![CDATA[
					[CreateTime] <= #Ed#
					]]>
				</isPropertyAvailable>
				<isPropertyAvailable property="Statuses" prepend="AND">
					[Status] in(<iterate property="Statuses" conjunction=",">#Statuses[]#</iterate>)
				</isPropertyAvailable>
			</dynamic>
		</select>
		

		<select id="GetList" parameterClass="map" resultClass="TOrder">
			SELECT
				[OrderId]
				, [OrderType]
				, [UserId]
				, [Email]
				, [Total]
				, [PayWay]
				, [Ip]
				, [Status]
				, [CreateTime]
				, [PayTime]
				, [Remark]
				, [AdminRemark]
				, [UpdateTime]
 FROM 
			(SELECT
			<isPropertyAvailable property="Top" prepend="">
				Top (#Top#)
			</isPropertyAvailable>
			<isPropertyAvailable property="OrderBy" prepend="">
				ROW_NUMBER() OVER (order by $OrderBy$) as RowNumber,
			</isPropertyAvailable>
			*
			FROM [TOrder]
			<dynamic prepend="WHERE">
				<isPropertyAvailable property="OrderType" prepend="AND">
					[OrderType] = #OrderType#
				</isPropertyAvailable>
				<isPropertyAvailable property="UserId" prepend="AND">
					[UserId] = #UserId#
				</isPropertyAvailable>
				<isPropertyAvailable property="Email" prepend="AND">
					[Email] = #Email#
				</isPropertyAvailable>
				<isPropertyAvailable property="Total" prepend="AND">
					[Total] = #Total#
				</isPropertyAvailable>
				<isPropertyAvailable property="PayWay" prepend="AND">
					[PayWay] = #PayWay#
				</isPropertyAvailable>
				<isPropertyAvailable property="Ip" prepend="AND">
					[Ip] = #Ip#
				</isPropertyAvailable>
				<isPropertyAvailable property="Status" prepend="AND">
					[Status] = #Status#
				</isPropertyAvailable>
				<isPropertyAvailable property="CreateTime" prepend="AND">
					[CreateTime] = #CreateTime#
				</isPropertyAvailable>
				<isPropertyAvailable property="PayTime" prepend="AND">
					[PayTime] = #PayTime#
				</isPropertyAvailable>
				<isPropertyAvailable property="Remark" prepend="AND">
					[Remark] = #Remark#
				</isPropertyAvailable>
				<isPropertyAvailable property="AdminRemark" prepend="AND">
					[AdminRemark] = #AdminRemark#
				</isPropertyAvailable>
				<isPropertyAvailable property="UpdateTime" prepend="AND">
					[UpdateTime] = #UpdateTime#
				</isPropertyAvailable>
				<isPropertyAvailable property="Sd" prepend="AND">
					<![CDATA[
					[CreateTime] >= #Sd#
					]]>
				</isPropertyAvailable>
				<isPropertyAvailable property="Ed" prepend="AND">
					<![CDATA[
					[CreateTime] <= #Ed#
					]]>
				</isPropertyAvailable>
				<isPropertyAvailable property="Statuses" prepend="AND">
					[Status] in(<iterate property="Statuses" conjunction=",">#Statuses[]#</iterate>)
				</isPropertyAvailable>
			</dynamic>
			) t
			<dynamic prepend="WHERE">
				<isPropertyAvailable property="StartRecord" prepend="AND">
				RowNumber>#StartRecord#
				</isPropertyAvailable>
			</dynamic>
		</select>
		
		<select id="Get" parameterClass="Int32" resultClass="TOrder">
			SELECT
				[OrderId]
				, [OrderType]
				, [UserId]
				, [Email]
				, [Total]
				, [PayWay]
				, [Ip]
				, [Status]
				, [CreateTime]
				, [PayTime]
				, [Remark]
				, [AdminRemark]
				, [UpdateTime]
			FROM [TOrder]
			WHERE
				([OrderId] = #OrderId#)
		</select>

    <select id="GetListForExchange" parameterClass="map" resultClass="TOrder">
      SELECT
      [OrderId]
      , [OrderType]
      , [UserId]
      , [Email]
      , [Total]
      , [PayWay]
      , [Ip]
      , [Status]
      , [CreateTime]
      , [PayTime]
      , [Remark]
      , [AdminRemark]
      , [UpdateTime]
      , [UserEmail] as [User.Email]
      , [NickName] as [User.NickName]
      , [HeadIcon] as [User.HeadIcon]
      , [TotalExchange] as [Account.TotalExchange]
      FROM
      (SELECT
      <isPropertyAvailable property="Top" prepend="">
        Top (#Top#)
      </isPropertyAvailable>
      <isPropertyAvailable property="OrderBy" prepend="">
        ROW_NUMBER() OVER (order by $OrderBy$) as RowNumber,
      </isPropertyAvailable>
      a.*,b.Email as UserEmail,b.NickName,b.HeadIcon,c.TotalExchange
      FROM [TOrder] a LEFT JOIN [U_UserInfo] b ON a.UserId=b.UserId
      LEFT JOIN [MAccount] c ON a.UserId=c.UserId
      <dynamic prepend="WHERE">
        <isPropertyAvailable property="OrderType" prepend="AND">
          [OrderType] = #OrderType#
        </isPropertyAvailable>
        <isPropertyAvailable property="UserId" prepend="AND">
          a.[UserId] = #UserId#
        </isPropertyAvailable>
        <isPropertyAvailable property="Email" prepend="AND">
          a.[Email] = #Email#
        </isPropertyAvailable>
        <isPropertyAvailable property="Total" prepend="AND">
          [Total] = #Total#
        </isPropertyAvailable>
        <isPropertyAvailable property="PayWay" prepend="AND">
          [PayWay] = #PayWay#
        </isPropertyAvailable>
        <isPropertyAvailable property="Ip" prepend="AND">
          [Ip] = #Ip#
        </isPropertyAvailable>
        <isPropertyAvailable property="Status" prepend="AND">
          [Status] = #Status#
        </isPropertyAvailable>
        <isPropertyAvailable property="CreateTime" prepend="AND">
          [CreateTime] = #CreateTime#
        </isPropertyAvailable>
        <isPropertyAvailable property="PayTime" prepend="AND">
          [PayTime] = #PayTime#
        </isPropertyAvailable>
        <isPropertyAvailable property="Remark" prepend="AND">
          [Remark] = #Remark#
        </isPropertyAvailable>
        <isPropertyAvailable property="AdminRemark" prepend="AND">
          [AdminRemark] = #AdminRemark#
        </isPropertyAvailable>
        <isPropertyAvailable property="UpdateTime" prepend="AND">
          [UpdateTime] = #UpdateTime#
        </isPropertyAvailable>
        <isPropertyAvailable property="Sd" prepend="AND">
          <![CDATA[
					[CreateTime] >= #Sd#
					]]>
        </isPropertyAvailable>
        <isPropertyAvailable property="Ed" prepend="AND">
          <![CDATA[
					[CreateTime] <= #Ed#
					]]>
        </isPropertyAvailable>
      </dynamic>
      ) t
      <dynamic prepend="WHERE">
        <isPropertyAvailable property="StartRecord" prepend="AND">
          RowNumber>#StartRecord#
        </isPropertyAvailable>
      </dynamic>
    </select>

		
		<insert id="Insert" parameterClass="TOrder" resultClass="Int32">
			INSERT INTO [TOrder] (
			[OrderId]
			,[OrderType]
			, [UserId]
			, [Email]
			, [Total]
			, [PayWay]
			, [Ip]
			, [Status]
			, [CreateTime]
			, [PayTime]
			, [Remark]
			, [AdminRemark]
			, [UpdateTime]
			, [ExchangeAccId]
			) VALUES (
			#OrderId#
			, #OrderType#
			, #UserId#
			, #Email#
			, #Total#
			, #PayWay#
			, #Ip#
			, #Status#
			, #CreateTime#
			, #PayTime#
			, #Remark#
			, #AdminRemark#
			, #UpdateTime#
			, #ExchangeAccId#
			)

			SELECT @@ROWCOUNT
		</insert>

		<update id="Update" parameterClass="TOrder" resultClass="Int32">
			UPDATE [TOrder] SET
				 [OrderType] = #OrderType#
				, [UserId] = #UserId#
				, [Email] = #Email#
				, [Total] = #Total#
				, [PayWay] = #PayWay#
				, [Ip] = #Ip#
				, [Status] = #Status#
				, [CreateTime] = #CreateTime#
				, [PayTime] = #PayTime#
				, [Remark] = #Remark#
				, [AdminRemark] = #AdminRemark#
				, [UpdateTime] = #UpdateTime#
			WHERE
				([OrderId] = #OrderId#)
				
			SELECT @@rowcount
		</update>

		<delete id="Delete" parameterClass="int32" resultClass="Int32">
			DELETE FROM [TOrder]
			WHERE
				([OrderId] = #OrderId#)
				
			select @@rowcount
		</delete>

		<update id="UpdateState2Paid" parameterClass="map" resultClass="Int32">
			UPDATE [TOrder] SET
			[Status] = #State#	,UpdateTime=getdate(),PayTime=getdate(),[PayWay] = #PayWay#
			WHERE
			([OrderId] = #OrderId#)
			SELECT @@rowcount
		</update>
		
	</statements>
</sqlMap>
