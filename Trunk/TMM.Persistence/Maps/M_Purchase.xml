<?xml version="1.0" encoding="utf-8" ?> 
<!--============================================================================
//	CAUTION: This file is generated by IBatisNetGen.BatisMap.cst at 2010-12-17 15:46:12
//				By xincai.wu
//===========================================================================-->
<sqlMap namespace="MPurchase"
	xmlns="http://ibatis.apache.org/mapping" 
	xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">

	<alias>
		<typeAlias alias="MPurchase" type="TMM.Model.MPurchase,TMM.Models" />
	</alias>

	<statements>

		<select id="GetCount"  parameterClass="map" resultClass="System.Int32">
			SELECT count(*) FROM [M_Purchase]
			<dynamic prepend="WHERE">
				<isPropertyAvailable property="UserId" prepend="AND">
					[UserId] = #UserId#
				</isPropertyAvailable>
				<isPropertyAvailable property="DocId" prepend="AND">
					[DocId] = #DocId#
				</isPropertyAvailable>
				<isPropertyAvailable property="Title" prepend="AND">
					[Title] = #Title#
				</isPropertyAvailable>
				<isPropertyAvailable property="PurchaseTime" prepend="AND">
					[PurchaseTime] = #PurchaseTime#
				</isPropertyAvailable>
				<isPropertyAvailable property="Price" prepend="AND">
					[Price] = #Price#
				</isPropertyAvailable>
				<isPropertyAvailable property="Saler" prepend="AND">
					[Saler] = #Saler#
				</isPropertyAvailable>
			</dynamic>
		</select>
		

		<select id="GetList" parameterClass="map" resultClass="MPurchase">
			SELECT
			[Pid]
			, [UserId]
			, [DocId]
			, [Title]
			, [PurchaseTime]
			, [Price]
			, [Saler]
			, [DocType]
			, [Email] as [UploaderInfo.Email]
			, [NickName] as [UploaderInfo.NickName]
			, [HeadIcon] as [UploaderInfo.HeadIcon]
			FROM
			(SELECT
			<isPropertyAvailable property="Top" prepend="">
				Top (#Top#)
			</isPropertyAvailable>
			<isPropertyAvailable property="OrderBy" prepend="">
				ROW_NUMBER() OVER (order by $OrderBy$) as RowNumber,
			</isPropertyAvailable>
			a.*,b.Email,b.NickName,b.HeadIcon
			FROM [M_Purchase] a LEFT JOIN [U_UserInfo] b ON a.Saler=b.UserId
			<dynamic prepend="WHERE">
				<isPropertyAvailable property="UserId" prepend="AND">
					a.[UserId] = #UserId#
				</isPropertyAvailable>
				<isPropertyAvailable property="DocId" prepend="AND">
					[DocId] = #DocId#
				</isPropertyAvailable>
				<isPropertyAvailable property="Title" prepend="AND">
					[Title] = #Title#
				</isPropertyAvailable>
				<isPropertyAvailable property="PurchaseTime" prepend="AND">
					[PurchaseTime] = #PurchaseTime#
				</isPropertyAvailable>
				<isPropertyAvailable property="Price" prepend="AND">
					[Price] = #Price#
				</isPropertyAvailable>
				<isPropertyAvailable property="Saler" prepend="AND">
					[Saler] = #Saler#
				</isPropertyAvailable>
			</dynamic>
			) t
			<dynamic prepend="WHERE">
				<isPropertyAvailable property="StartRecord" prepend="AND">
				RowNumber>#StartRecord#
				</isPropertyAvailable>
			</dynamic>
		</select>
		
		<select id="Get" parameterClass="Int32" resultClass="MPurchase">
			SELECT
			[Pid]
			, [UserId]
			, [DocId]
			, [Title]
			, [PurchaseTime]
			, [Price]
			, [Saler]
			, [DocType]
			FROM [M_Purchase]
			WHERE
			([Pid] = #Pid#)
		</select>
		
		

		
		<insert id="Insert" parameterClass="MPurchase" resultClass="Int32">
			INSERT INTO [M_Purchase] (
			[UserId]
			, [DocId]
			, [Title]
			, [PurchaseTime]
			, [Price]
			, [Saler]
			, [DocType]
			) VALUES (
			#UserId#
			, #DocId#
			, #Title#
			, #PurchaseTime#
			, #Price#
			, #Saler#
			, #DocType#
			)

			SELECT @@IDENTITY
		</insert>

		<update id="Update" parameterClass="MPurchase" resultClass="Int32">
			UPDATE [M_Purchase] SET
			[UserId] = #UserId#
			, [DocId] = #DocId#
			, [Title] = #Title#
			, [PurchaseTime] = #PurchaseTime#
			, [Price] = #Price#
			, [Saler] = #Saler#
			, [DocType] = #DocType#
			WHERE
			([Pid] = #Pid#)

			SELECT @@rowcount
		</update>

		<delete id="Delete" parameterClass="int32" resultClass="Int32">
			DELETE FROM [M_Purchase]
			WHERE
				([Pid] = #Pid#)
				
			select @@rowcount
		</delete>
		
	</statements>
</sqlMap>
